<script src="p5.js"></script>
<script src="StackBlur.js"></script>
<script src="lsystem.js"></script>
<script>

  var angle = 30;
  var d = 120;
  var iter = 12;

  var w = 1920;
  var h = 1080;
  var x = w * .5;
  var y = h * .5;
  var r = -135;

  var cInc = +0.01;

  var c;
  var system = new LSystem({
    axiom: 'f',
    rules: {
      'f': '[+gf][-gf]'
    },
    renderRules: {
      'f': function () {
        //stackBlurCanvasRGBA('defaultCanvas', 0, 0, w, h, 1);
        stroke(c);
    strokeWeight(0.01);
        noFill();
        line(0, 0, d, 0);
        translate(d, 0);
      },
      'g': function () {
        stroke(c);
        strokeWeight(0.01);
        rect(0, 0, d/2, d/2);
        translate(d/2, 0);
      },
      'h': function () {
        rect(0, 0, d/3, d/3),
        translate(2 * d / 3, 0);
      },
      'i': function () {
        line(0, 0, d/4, d/4),
        translate(2 * d / 8, 0);
      },

      '<': function () {
        c = color((c.hsba[0] - cInc) % 360, c.hsba[1], c.hsba[2], c.hsba[3]);
      },
      '>': function () {
        c = color((c.hsba[0] + cInc) % 360, c.hsba[1], c.hsba[2], c.hsba[3]);
      },
      '[': function () {
        push();
      },
      ']': function () {
        pop();
      },
      '+': function () {
        rotate(angle);
      },
      '-': function () {
        rotate(-1 * angle);
      }
    }
  });

  function setup() {
    angleMode(DEGREES);
    colorMode(HSB);
    c = color(0,0,100);
    frameRate(1);
    createCanvas(w, h);
    noFill();
    background(color(0,0,30,1));
    translate(x, y);
    rotate(r);
    push();
    system.reset();
    system.simulate(iter);
    console.log(system.getState());
    system.render();
    pop();
  }


</script>

